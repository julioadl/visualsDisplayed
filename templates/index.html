<!DOCTYPE html>
<html>

<head>
	<title>Why Trump?</title>
	<script src="https://d3js.org/d3.v3.min.js"></script>
</head>

<body>

	<div id="tree" style="height: 600px">
	</div>
</body>

<script>
	var margin = {
		top: 20,
		right: 20,
		bottom: 20,
		left: 20
	};
	var winWidth = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
	var width = (winWidth - margin.left - margin.right),
		height = (winWidth / 2);

	var diagonal = d3.svg.diagonal()
		.projection(function (d) {return [d.y * width, (d.x * height + 10)]})

	var svg = d3.select("#tree")
		.append("svg")
		.attr('width', width)
		.attr('height', 2 *height)

	var tree = d3.layout.tree()

	d3.json("/data", function(data) {
		var nodes = tree.nodes(data)
		var edges = tree.links(nodes)

		var node = svg.selectAll(".node")
			.data(nodes)
			.enter()
			.append("g")
				.attr("class", "node")
				.attr("transform", function (d) { return 'translate(' + (d.y * width) + ',' + (d.x * height + 10)  + ')';})

		node.append("circle")
			.attr("r", "5")
			.attr("stroke", "none")
			.attr("fill", "none")

		node.append("text")
			.text(function (d) { return d.name;})
			.style("font-size", "15px")
			.style("font-family", "Helvetica")
			.attr("dy", "-10")

		var polling = [6, 22,2,8,4,1,3,2, 0.5,3,11,1,32,7,5,4,11,7,7,7,4,4,3,14,21,21,22,
			30,30,1,3,3,1,2,2,2,1,2,5,12,20,20,0.5, 3,1,1,10,11,20,18,1,1,1,38,37,29,36,44,44, 44]

		path = svg.selectAll(".link")
			.data(edges)
			.enter()
			.append("path")
			.attr("class", "link")
			.attr("fill", "none")
			.attr("stroke", "red")
			.attr("d", diagonal)
			.data(polling)
			.attr("stroke-width", "10")
			.style("stroke-opacity", function (d) {return (d * .035)})
			console.log(edges)

		var totalLength = path.node().getTotalLength();

		path.transition()
			.attr("stroke-dasharray", totalLength + " " + totalLength)
			.attr("stroke-dashoffset", totalLength)
			.transition()
			.duration(2000)
			.ease("exponential")
			.attr("stroke-dashoffset", 0);

		svg.append("line")
			.attr("x1", "0")
			.attr("y1", (height + 50))
			.attr("x2", winWidth)
			.attr("y2", (height + 50))
			.attr("stroke", "black")

	});
</script>

</html>
